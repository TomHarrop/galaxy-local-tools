<tool id="metawrapmg_binning" name="MetaWRAP" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" license="MIT">
    <description>metagenome binning pipeline.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xrefs"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            ## set memory usage
            ## use GALAXY_MEMORY_MB if set 
            ## otherwise `free -g | awk '/^Mem:/{print $2}'`


            ## should always be FASTA
            #set mg_fn = 'metagenome.' + str($metagenome.ext)
            ln -s '$metagenome' $mg_fn &&

            ## should always be FASTQ
            #set input1_fn = 'reads1.' + str($input_1.ext)
            ln -s '$input_1' $input1_fn &&

            ## should always be FASTQ
            #set input2_fn = 'reads2.' + str($input_2.ext)
            ln -s '$input_2' $input2_fn &&

            ## run binning
            metawrap binning 
            --metabat2 --maxbin2 --concoct 
            -a '$mg_fn'
            -t \${GALAXY_SLOTS:-4}
            -m \${GALAXY_MEMORY_GB:-8}
            -o INITIAL_BINNING
            '$input1_fn'
            '$input2_fn'

            ############
            ## FIXME! ##
            ############
            && touch output.fa
    ]]></command>
    <inputs>
        <!-- metagenome assembly -->
        <param name="metagenome" format="@FASTQ_TYPES@" type="data" label="FASTQ/A file #1" help="Should be of datatype &quot;fastq.gz&quot;or &quot;fasta&quot;" />
        <!-- fastq files (needs to be a repeat or a collection) -->
        <param name="input_1" format="@FASTQ_TYPES@" type="data" label="FASTQ/A file #1" help="Should be of datatype &quot;fastq.gz&quot;or &quot;fasta&quot;" />
        <param name="input_2" format="@FASTQ_TYPES@" type="data" label="FASTQ/A file #2" help="Should be of datatype &quot;fastq.gz&quot;or &quot;fasta&quot;" />
    </inputs>git s
    <outputs>
        <data name="fa" format="fasta" from_work_dir="output.fa" label="${tool.name} on ${on_string} (contigs)">
        </data>
    </outputs>
    <tests>
        <!-- basic function -->
        <test expect_num_outputs="1">
            <param name="metagenome" value="final_assembly.fasta"/>
            <param name="input_1" value="final_pure_reads_1.fastq"/>
            <param name="input_2" value="final_pure_reads_1.fastq"/>
            <output name="fa" ftype="fasta" file="metawrapmg_binning_test1.fa"/>
        </test>
    </tests>
        <help><![CDATA[
            FIXME
        ]]></help>
    <expand macro="citations"/>
</tool>
