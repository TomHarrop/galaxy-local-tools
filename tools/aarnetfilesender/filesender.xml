<?xml version="1.0"?>

<tool id="aarnet_filesender" name="AARNet FileSender" version="3.0.0" workflow_compatible="true">
    <requirements>
        <requirement type="package" version="3.0.0">filesendercli</requirement>
    </requirements>
    <command><![CDATA[

#set $apiuser = $__user__.extra_preferences.get('aarnet_filesender_account|username', "").strip()
#set $apikey = $__user__.extra_preferences.get('aarnet_filesender_account|apikey', "").strip()

mkdir filestosend &&

#for $file in $data
    ln -s "$file" "filestosend/${file.element_identifier}" &&
#end for

filesender -p -u '$apiuser' -a '$apikey' -b https://filesender.aarnet.edu.au/rest.php -f "galaxy-no-reply@usegalaxy.org.au" -r '$to' filestosend >$output 2>&1

    ]]></command>
    <inputs>
        <param name="data" type="data" multiple="true" optional="false" label="Datasets to be sent:" />
        <param name="to" type="text" optional="false" label="Email address of recipent:"><sanitizer sanitize="False"/></param>
    </inputs>
    <outputs>
        <data name="output" type="data" format="txt" hidden="false"/>
    </outputs>
    <help>
**What it does**
        Send dataset(s) from Galaxy to anyone via AARNet's FileSender service.

**Remarks**
        This tool leverages AARNet's FileSender (https://filesender.aarnet.edu.au)
        to send files out of Galaxy.

        If selecting multiple datasets, make sure each dataset is named
        differently; otherwise, only one copy of the selected datasets will be
        sent.
    </help>
</tool>
